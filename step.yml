#
# A couple of useful guides & docs:
#
# - Main Bitrise CLI docs: https://github.com/bitrise-io/bitrise/tree/master/_docs
# - Step Development Guideline: https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
# - Bitrise.yml format spec: https://github.com/bitrise-io/bitrise/blob/master/_docs/bitrise-yml-format-spec.md
# - Bitrise docs: http://devcenter.bitrise.io/
# - Bitrise CLI guides: http://devcenter.bitrise.io/bitrise-cli/

title: |-
  [Beta] Bitbucket And Bitrise Tools
summary: |
  This step will check if the PR Title contains "[SV]" tag, it will stop the build on bit rise and add the commit status "FAILED" on the head commit of the PR.
description: |
  Checkout details for available functions and how they work:
  https://github.com/KageRiyuu/bitrise-step-bitbucket-server-tools/blob/main/README.md
website: https://github.com/KageRiyuu/bitrise-step-bitbucket-server-tools/tree/main
source_code_url: https://github.com/KageRiyuu/bitrise-step-bitbucket-server-tools/tree/main
support_url: https://github.com/KageRiyuu/bitrise-step-bitbucket-server-tools/tree/main
type_tags:
  - utility

is_always_run: true
is_skippable: true
run_if: ""


toolkit:
  go:
    package_name: bitbucket-tools


inputs:

  - bitbucket_api_access_token:
    opts:
      category: Bitbucket
      title: Bitbucket Access Token
      summary: Token to access you bitbucket account
      is_required: true
      is_sensitive: true

  - bitbucket_domain:
    opts:
      category: Bitbucket
      title: Bitbucket Server Domain Name 
      summary: Your Bitbucket server url
      is_required: true
      is_sensitive: false

  - bitbucket_project_key:
    opts:
      category: Bitbucket
      title: Bitbucket Project Key
      summary: Key of your Project in Bitbucket
      is_required: true
      is_sensitive: false

  - bitbucket_repo_slug:
    opts:
      category: Bitbucket
      title: Bitbucket Repo Slug
      summary: Id of the repository in Bitbucket
      is_required: true
      is_sensitive: false

  - bitrise_api_access_token:
    opts:
      category: Bitrise
      title: Bitrise Access Token
      summary: Auth token needed to call Bitrise Apis
      is_required: true
      is_sensitive: true

  - bitrise_app_slug: $BITRISE_APP_SLUG
    opts:
      category: Bitrise
      title: Bitrise App Slug
      summary: Id of the app in Bitrise
      is_required: true
      is_sensitive: false

  - function: "Skip Verification"
    opts:
      category: Function
      title: Function
      summary: Function you want to perform
      is_required: true
      is_sensitive: false
      value_options:
      - "Skip Verification"
      - "Clean PR (Not Available)"

  - pr_id: $BITRISE_PULL_REQUEST
    opts:
      category: Function
      title: Pull Request Id
      summary: Id of the Pull Request
      is_required: false
      is_sensitive: false

  - bitrise_build_slug: $BITRISE_BUILD_SLUG
    opts:
      category: Function
      title: Bitrise Build Slug
      summary: Id of the Build in Bitbucket
      is_required: false
      is_sensitive: false

  - emails:
    opts:
      category: Function
      title: List of Emails
      summary: Emails seperated by ,
      is_required: false
      is_sensitive: false

  - required_approval_count: 2
    opts:
      category: Function
      title: Approvals Required
      summary: Minimum number of approvals required in Pull Request.
      is_required: false
      is_sensitive: false

outputs:
  - SKIPPED_VERIFICATION:  
    opts:    
      title: Skipped Verification
      summary: True or False, telling is verfication skipped or not

  - PULL_REQUESTS_DEADLINE_NEAR:  
    opts:    
      title: Is Pull Requests Deadline Near
      summary: True or False, telling is any unapproved pull request deadline is near.

  - PULL_REQUESTS_DEADLINE:  
    opts:    
      title: Pull Requests Deadline Details
      summary: Details of all Open and Unapproved Pull Requests. Check `Read Me` for details.